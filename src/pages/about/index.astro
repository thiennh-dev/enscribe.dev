---
import Breadcrumbs from "@/components/Breadcrumbs.astro";
import Link from "@/components/Link.astro";
import PageHead from "@/components/PageHead.astro";
import { Badge } from "@/components/ui/badge";
import Layout from "@/layouts/Layout.astro";
// ðŸš« Remove this, don't do SSR Spotify fetch in .astro anymore
// import { getNowPlaying } from '@/lib/spotify'
// const nowPlaying = await getNowPlaying()
---

<Layout class="max-w-svh">
  <PageHead slot="head" title="Tags" />
  
  <p>
    Sure! Here's a sample long paragraph of text you can use for testing or filler content:
    In an increasingly interconnected world, the rapid evolution of technology continues to reshape how we live, communicate, and work...
    Let me know if you'd like it tailored for a specific topic like tech, history, blog post, or lorem ipsum style!
  </p>

  <p><strong>Now Playing:</strong></p>
  <div id="now-playing">Loading...</div>

  <script type="module">
    document.addEventListener('DOMContentLoaded', () => {
      const el = document.getElementById('now-playing');
      if (!el) return; // âœ… Type-safe null guard

      async function loadNowPlaying() {
        try {
          const res = await fetch('/api/spotify');
          if (!res.ok) {
            el.textContent = 'Error fetching now playing';
            return;
          }

          const data = await res.json();

          if (data?.item?.name) {
            const artists = data.item.artists.map((a) => a.name).join(', ');
            el.textContent = `ðŸŽµ ${data.item.name} â€” ${artists}`;
          } else {
            el.textContent = 'Nothing is playing';
          }
        } catch (err) {
          console.error('Fetch error:', err);
          el.textContent = 'Failed to load now playing';
        }
      }

      loadNowPlaying();
      setInterval(loadNowPlaying, 4000);
    });
  </script>
</Layout>
