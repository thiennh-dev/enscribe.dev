---
import PageHead from "@/components/PageHead.astro";
import Layout from "@/layouts/Layout.astro";
---

<Layout class="max-w-svh">
  <PageHead slot="head" title="Tags" />
  
  <p>
    Sure! Here's a sample long paragraph of text you can use for testing or filler content:
    In an increasingly interconnected world, the rapid evolution of technology continues to reshape how we live, communicate, and work...
    Let me know if you'd like it tailored for a specific topic like tech, history, blog post, or lorem ipsum style!
  </p>

  <p><strong>Now Playing:</strong></p>
  <div id="now-playing" class="text-sm p-3 rounded-lg font-mono whitespace-pre-wrap">
    Loading...
  </div>

  <script type="module">
    document.addEventListener('DOMContentLoaded', () => {
      const el = document.getElementById('now-playing');
      if (!el) return;

      async function loadNowPlaying() {
        try {
          const res = await fetch('/api/spotify');
          const data = await res.json();

          if (!data.ok) {
            el.innerHTML = `
‚ùå ${data.message || 'No song playing'}
Status: ${data.status}
Fetched at: ${data.fetchedAt}
            `.trim();
            return;
          }

          el.innerHTML = `
üéµ ${data.name} ‚Äî ${data.artists}
Status: ${data.status}
Fetched at: ${new Date(data.fetchedAt).toLocaleString('en-US', {
  timeZone: 'Asia/Bangkok',
  hour12: false,
})}

          `.trim();
        } catch (err) {
          console.error('Fetch error:', err);
          el.textContent = '‚ùå Failed to fetch now playing info.';
        }
      }

      loadNowPlaying();
      setInterval(loadNowPlaying, 4000);
    });
  </script>
</Layout>
